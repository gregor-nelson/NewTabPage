<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahoo Finance Symbol Tester</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .category {
            margin: 20px 0;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
        }
        .category-title {
            font-size: 18px;
            font-weight: bold;
            color: #4a9eff;
            margin-bottom: 10px;
        }
        .test-row {
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-row.loading {
            background: #2a2a2a;
            color: #888;
        }
        .test-row.success {
            background: #1a3a1a;
            color: #4ade80;
        }
        .test-row.error {
            background: #3a1a1a;
            color: #f87171;
        }
        .symbol-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .symbol {
            min-width: 120px;
            font-weight: bold;
        }
        .name {
            min-width: 200px;
            color: #aaa;
        }
        .price {
            min-width: 100px;
            text-align: right;
        }
        .status {
            min-width: 80px;
            text-align: right;
            font-size: 12px;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background: #3a8eef;
        }
        .summary {
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .summary-stat {
            display: inline-block;
            margin-right: 20px;
        }
        .summary-stat .label {
            color: #888;
        }
        .summary-stat .value {
            font-weight: bold;
            font-size: 18px;
        }
        .success-text { color: #4ade80; }
        .error-text { color: #f87171; }
    </style>
</head>
<body>
    <h1>Yahoo Finance Symbol Verification Test</h1>

    <div class="controls">
        <button onclick="testAllSymbols()">Test All Symbols</button>
        <button onclick="testCategory('volatility')">Test Volatility Only</button>
        <button onclick="exportResults()">Export Results</button>
    </div>

    <div class="summary" id="summary">
        <div class="summary-stat">
            <span class="label">Total: </span>
            <span class="value" id="total-count">0</span>
        </div>
        <div class="summary-stat">
            <span class="label">Success: </span>
            <span class="value success-text" id="success-count">0</span>
        </div>
        <div class="summary-stat">
            <span class="label">Failed: </span>
            <span class="value error-text" id="fail-count">0</span>
        </div>
        <div class="summary-stat">
            <span class="label">Pending: </span>
            <span class="value" id="pending-count">0</span>
        </div>
    </div>

    <div id="test-results"></div>

    <script>
        const YAHOO_API_BASE = 'https://query1.finance.yahoo.com/v8/finance/chart/';
        const STAGGER_DELAY = 500; // 500ms between requests to avoid rate limiting

        const SYMBOLS_TO_TEST = {
            'current-indices': [
                { symbol: '^GSPC', name: 'S&P 500', note: 'Currently tracking' },
                { symbol: '^IXIC', name: 'Nasdaq Composite', note: 'Currently tracking' },
                { symbol: '^DJI', name: 'Dow Jones', note: 'Currently tracking' }
            ],
            'additional-indices': [
                { symbol: '^RUT', name: 'Russell 2000', note: 'Small caps' },
                { symbol: '^RLG', name: 'Russell 1000 Growth', note: 'Growth stocks' },
                { symbol: '^RLV', name: 'Russell 1000 Value', note: 'Value stocks' },
                { symbol: '^W5000', name: 'Wilshire 5000', note: 'Total market' }
            ],
            'volatility': [
                { symbol: '^VIX', name: 'VIX', note: 'Currently tracking' },
                { symbol: '^VVIX', name: 'VVIX', note: 'Volatility of VIX' },
                { symbol: '^VIX9D', name: 'VIX 9-Day', note: 'Short-term vol' },
                { symbol: '^VXST', name: 'VXST', note: 'Very short-term VIX' }
            ],
            'treasuries': [
                { symbol: '^IRX', name: '3-Month Treasury', note: '13-week T-Bill' },
                { symbol: '^FVX', name: '5-Year Treasury', note: 'Treasury Note' },
                { symbol: '^TNX', name: '10-Year Treasury', note: 'Currently tracking' },
                { symbol: '^TYX', name: '30-Year Treasury', note: 'Currently tracking (mislabeled as GILT30)' },
                { symbol: '^UST2Y', name: '2-Year Treasury (Alt 1)', note: 'Test symbol' },
                { symbol: '^2YY', name: '2-Year Treasury (Alt 2)', note: 'Test symbol' }
            ],
            'currencies': [
                { symbol: 'DX-Y.NYB', name: 'US Dollar Index', note: 'DXY' },
                { symbol: 'EURUSD=X', name: 'EUR/USD', note: 'Euro' },
                { symbol: 'JPY=X', name: 'USD/JPY', note: 'Japanese Yen' },
                { symbol: 'GBPUSD=X', name: 'GBP/USD', note: 'British Pound' },
                { symbol: 'USDGBP=X', name: 'USD/GBP', note: 'Currently tracking (inverted)' },
                { symbol: 'AUDUSD=X', name: 'AUD/USD', note: 'Australian Dollar' },
                { symbol: 'USDCAD=X', name: 'USD/CAD', note: 'Canadian Dollar' }
            ],
            'commodities': [
                { symbol: 'GC=F', name: 'Gold Futures', note: 'Currently tracking' },
                { symbol: 'SI=F', name: 'Silver Futures', note: 'Precious metal' },
                { symbol: 'HG=F', name: 'Copper Futures', note: 'Economic indicator' },
                { symbol: 'CL=F', name: 'WTI Crude Oil', note: 'Currently tracking' },
                { symbol: 'NG=F', name: 'Natural Gas', note: 'Energy' },
                { symbol: 'ZC=F', name: 'Corn Futures', note: 'Agriculture' },
                { symbol: 'ZW=F', name: 'Wheat Futures', note: 'Agriculture' }
            ],
            'international': [
                { symbol: '^FTSE', name: 'FTSE 100', note: 'UK' },
                { symbol: '^GDAXI', name: 'DAX', note: 'Germany' },
                { symbol: '^FCHI', name: 'CAC 40', note: 'France' },
                { symbol: '^N225', name: 'Nikkei 225', note: 'Japan' },
                { symbol: '000001.SS', name: 'Shanghai Composite', note: 'China' },
                { symbol: '^HSI', name: 'Hang Seng', note: 'Hong Kong' },
                { symbol: '^AXJO', name: 'ASX 200', note: 'Australia' },
                { symbol: '^FTSEMIB', name: 'FTSE MIB', note: 'Italy' }
            ],
            'bonds-etfs': [
                { symbol: 'HYG', name: 'iShares High Yield Bond', note: 'Corporate junk bonds' },
                { symbol: 'LQD', name: 'iShares Investment Grade', note: 'Corporate bonds' },
                { symbol: 'TLT', name: 'iShares 20+ Year Treasury', note: 'Long bonds' },
                { symbol: 'AGG', name: 'iShares Core US Aggregate', note: 'Total bond market' },
                { symbol: 'SHY', name: 'iShares 1-3 Year Treasury', note: 'Short bonds' }
            ],
            'sectors': [
                { symbol: 'XLK', name: 'Technology Select Sector', note: 'Tech' },
                { symbol: 'XLE', name: 'Energy Select Sector', note: 'Energy' },
                { symbol: 'XLF', name: 'Financial Select Sector', note: 'Financials' },
                { symbol: 'XLV', name: 'Health Care Select Sector', note: 'Healthcare' },
                { symbol: 'XLY', name: 'Consumer Discretionary', note: 'Consumer Disc' },
                { symbol: 'XLP', name: 'Consumer Staples', note: 'Consumer Staples' },
                { symbol: 'XLI', name: 'Industrial Select Sector', note: 'Industrials' },
                { symbol: 'XLB', name: 'Materials Select Sector', note: 'Materials' },
                { symbol: 'XLRE', name: 'Real Estate Select Sector', note: 'Real Estate' },
                { symbol: 'XLU', name: 'Utilities Select Sector', note: 'Utilities' },
                { symbol: 'XLC', name: 'Communication Services', note: 'Communication' }
            ],
            'futures': [
                { symbol: 'ES=F', name: 'S&P 500 Futures', note: 'E-mini S&P' },
                { symbol: 'NQ=F', name: 'Nasdaq 100 Futures', note: 'E-mini Nasdaq' },
                { symbol: 'YM=F', name: 'Dow Futures', note: 'E-mini Dow' }
            ],
            'crypto': [
                { symbol: 'BTC-USD', name: 'Bitcoin', note: 'Cryptocurrency' },
                { symbol: 'ETH-USD', name: 'Ethereum', note: 'Cryptocurrency' }
            ]
        };

        let testResults = {};

        function renderTestUI() {
            const container = document.getElementById('test-results');
            container.innerHTML = '';

            for (const [category, symbols] of Object.entries(SYMBOLS_TO_TEST)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.id = `category-${category}`;

                const title = document.createElement('div');
                title.className = 'category-title';
                title.textContent = category.replace(/-/g, ' ').toUpperCase();
                categoryDiv.appendChild(title);

                symbols.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'test-row loading';
                    row.id = `test-${item.symbol.replace(/[^a-zA-Z0-9]/g, '_')}`;

                    row.innerHTML = `
                        <div class="symbol-info">
                            <div class="symbol">${item.symbol}</div>
                            <div class="name">${item.name}</div>
                            <div class="note" style="color: #666;">${item.note}</div>
                        </div>
                        <div class="price">--</div>
                        <div class="status">Waiting...</div>
                    `;

                    categoryDiv.appendChild(row);
                });

                container.appendChild(categoryDiv);
            }

            updateSummary();
        }

        async function testSymbol(symbol, name, category) {
            const rowId = `test-${symbol.replace(/[^a-zA-Z0-9]/g, '_')}`;
            const row = document.getElementById(rowId);

            if (!row) return;

            row.className = 'test-row loading';
            row.querySelector('.status').textContent = 'Testing...';

            try {
                const endDate = Math.floor(Date.now() / 1000);
                const startDate = endDate - (2 * 24 * 60 * 60);
                const url = `${YAHOO_API_BASE}${symbol}?period1=${startDate}&period2=${endDate}&interval=1d`;

                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (!result.chart?.result?.[0]) {
                    throw new Error('No data in response');
                }

                const chartData = result.chart.result[0];
                const meta = chartData.meta;
                const price = meta.regularMarketPrice || meta.previousClose || 0;

                // Success!
                row.className = 'test-row success';
                row.querySelector('.price').textContent = price.toFixed(4);
                row.querySelector('.status').textContent = '✓ Success';

                testResults[symbol] = {
                    success: true,
                    category,
                    name,
                    price,
                    meta: {
                        currency: meta.currency,
                        exchangeName: meta.exchangeName,
                        marketState: meta.regularMarketState
                    }
                };

            } catch (error) {
                row.className = 'test-row error';
                row.querySelector('.price').textContent = '--';
                row.querySelector('.status').textContent = `✗ ${error.message}`;

                testResults[symbol] = {
                    success: false,
                    category,
                    name,
                    error: error.message
                };
            }

            updateSummary();
        }

        async function testAllSymbols() {
            testResults = {};
            renderTestUI();

            let delay = 0;
            for (const [category, symbols] of Object.entries(SYMBOLS_TO_TEST)) {
                for (const item of symbols) {
                    setTimeout(() => {
                        testSymbol(item.symbol, item.name, category);
                    }, delay);
                    delay += STAGGER_DELAY;
                }
            }
        }

        async function testCategory(categoryName) {
            const symbols = SYMBOLS_TO_TEST[categoryName];
            if (!symbols) {
                alert(`Category ${categoryName} not found`);
                return;
            }

            let delay = 0;
            for (const item of symbols) {
                setTimeout(() => {
                    testSymbol(item.symbol, item.name, categoryName);
                }, delay);
                delay += STAGGER_DELAY;
            }
        }

        function updateSummary() {
            const total = Object.keys(testResults).length;
            const success = Object.values(testResults).filter(r => r.success).length;
            const failed = Object.values(testResults).filter(r => !r.success).length;

            let totalSymbols = 0;
            for (const symbols of Object.values(SYMBOLS_TO_TEST)) {
                totalSymbols += symbols.length;
            }
            const pending = totalSymbols - total;

            document.getElementById('total-count').textContent = totalSymbols;
            document.getElementById('success-count').textContent = success;
            document.getElementById('fail-count').textContent = failed;
            document.getElementById('pending-count').textContent = pending;
        }

        function exportResults() {
            const successSymbols = Object.entries(testResults)
                .filter(([_, data]) => data.success)
                .map(([symbol, data]) => ({
                    symbol,
                    name: data.name,
                    category: data.category,
                    price: data.price,
                    currency: data.meta?.currency
                }));

            const failedSymbols = Object.entries(testResults)
                .filter(([_, data]) => !data.success)
                .map(([symbol, data]) => ({
                    symbol,
                    name: data.name,
                    category: data.category,
                    error: data.error
                }));

            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: Object.keys(testResults).length,
                    successful: successSymbols.length,
                    failed: failedSymbols.length
                },
                successfulSymbols,
                failedSymbols
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `yahoo-finance-test-results-${Date.now()}.json`;
            a.click();
        }

        // Initialize UI on load
        renderTestUI();
    </script>
</body>
</html>
